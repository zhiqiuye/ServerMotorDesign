/**
  ******************************************************************************
  * @file    Project/ucosii stm32f4 mdk475/node_can_config.h 
  * @author  Kuangjing
  * @version ucosii
  * @date    20170914
  * @brief   CAN节点的相关信息设置以及报文解析.
  ******************************************************************************
  ******************************************************************************
  */

#ifndef		__NODE_CAN_CONFIG_
#define		__NODE_CAN_CONFIG_

#include	"stm32f4xx.h"
#include	"global_parameters.h"
#include	"stm32f4xx_can.h"


/******************************************************************************
使用CAN标准帧，

CAN差分信号介绍：


            Vcan_H              ~~~\_______/~~~~~~~~~~~\______________
            Vcan_L              ___/~~~~~~~\___________/~~~~~~~~~~~~~~
			
			                        隐性位     显性位  
			bit						  1          0
*/									  
/*CAN标准帧格式：									  

                                                         CAN标准帧
    |<------------------------------------------------------------------------------------------------------------------->|
	| |     仲裁域  | 控制域 |                          数据域                               |                            |
	| |     12bits  | 6bits  |                         0-64bits                              |                            |  
    | |<----------->|<------>|<------------------------------------------------------------->|<-------------------------->|
    |S|           |R|I|R| D  |                             D                                 |       C       | |A |   E   |             
    |O|   StID    |T|D|0| L  |                             A                                 |       R       | |C |   O   |                
    |F|           |R|E| | C  |                             T                                 |       C       | |K |   F   |
    | |           |	| | |    |                                                               |               | |  |       |
	
bit: 1     11      1 1 1  4                               0-64                                       15       1  2    7

     |      |      | | |  |                                |                                          |       |  |    |________帧结束：由7个隐性位组成，由CAN控制器自动填充
     |      |      | | |  |                                |                                          |       |  |    
     |      |      | | |  |                                |                                          |       |  |_____________ACK段： 2位，由CAN控制器自动填充，包括应答位和应答界定位。应答界定位紧邻帧结束。在应答域中，发送器发出两个隐性位，当接收器正确的接收到有效的报文，该接收器就会在应答位期间，用一显性位填充应答位作为回应，而应答界定位一直保持为隐性    
     |      |      | | |  |                                |                                          |       |     
     |      |      | | |  |                                |                                          |       |________________CRC分隔符：隐性位  
     |      |      | | |  |                                |                                          |   
     |      |      | | |  |                                |                                          |________________________CRC段： 由CAN控制器自动填充  
     |      |      | | |  |                                |  
     |      |      | | |  |                                |___________________________________________________________________数据段：最大8字节 
     |      |      | | |  | 
     |      |      | | |  |____________________________________________________________________________________________________DLC：   数据长度代码，0-8字节
     |      |      | | |
     |      |      | | |_______________________________________________________________________________________________________R1、R0：保留位
     |      |      | |
     |      |      | |_________________________________________________________________________________________________________IDE：标识符扩展位，标准帧-显性，扩展帧-隐性，表示该帧为标准帧还是扩展帧
     |      |      |
     |      |      |___________________________________________________________________________________________________________RTR：远程发送请求位，数据帧中为显性，远程帧中为隐性
     |      |
     |      |__________________________________________________________________________________________________________________StID：标准帧ID，11位
     |
     |_________________________________________________________________________________________________________________________帧起始位




*/									  
/*CAN扩展帧格式：									  

                                                                        CAN扩展帧
    |<------------------------------------------------------------------------------------------------------------------------------------------>|
	| |              仲裁域                | 控制域 |                          数据域                               |                            |
	| |              32bits                | 6bits  |                         0-64bits                              |                            |
    | |<---------------------------------->|<------>|<------------------------------------------------------------->|<-------------------------->|
    |S|           |S|I|                  |R|R|R| D  |                             D                                 |       C       | |A |   E   |             
    |O|   StID    |R|D|      ExtID       |T|1|0| L  |                             A                                 |       R       | |C |   O   |                
    |F|           |R|E|                  |R| | | C  |                             T                                 |       C       | |K |   F   |
    | |           | | |                  | | | |    |                                                               |               | |  |       |
	
bit: 1     11      1 1         18         1 1 1  4                               0-64                                       15       1  2    7

     |      |      | |          |         | | |  |                                |                                          |       |  |    |________帧结束：由7个隐性位组成，由CAN控制器自动填充
     |      |      | |          |         | | |  |                                |                                          |       |  |    
     |      |      | |          |         | | |  |                                |                                          |       |  |_____________ACK段： 2位，由CAN控制器自动填充，包括应答位和应答界定位。应答界定位紧邻帧结束。在应答域中，发送器发出两个隐性位，当接收器正确的接收到有效的报文，该接收器就会在应答位期间，用一显性位填充应答位作为回应，而应答界定位一直保持为隐性    
     |      |      | |          |         | | |  |                                |                                          |       |     
     |      |      | |          |         | | |  |                                |                                          |       |________________CRC分隔符：隐性位  
     |      |      | |          |         | | |  |                                |                                          |   
     |      |      | |          |         | | |  |                                |                                          |________________________CRC段： 由CAN控制器自动填充  
     |      |      | |          |         | | |  |                                |  
     |      |      | |          |         | | |  |                                |___________________________________________________________________数据段：最大8字节 
     |      |      | |          |         | | |  | 
     |      |      | |          |         | | |  |____________________________________________________________________________________________________DLC：   数据长度代码，0-8字节
     |      |      | |          |         | | |
     |      |      | |          |         | | |_______________________________________________________________________________________________________R1、R0：保留位
     |      |      | |          |         | |
     |      |      | |          |         | |_________________________________________________________________________________________________________R1、R0：保留位
     |      |      | |          |         |
     |      |      | |          |         |___________________________________________________________________________________________________________RTR：远程发送请求位，数据帧中为显性，远程帧中为隐性
     |      |      | |          |         
     |      |      | |          |_____________________________________________________________________________________________________________________ExtID：扩展标识位
     |      |      | |
     |      |      | |________________________________________________________________________________________________________________________________IDE：标识符扩展位，标准帧-显性，扩展帧-隐性，表示该帧为标准帧还是扩展帧
     |      |      |
     |      |      |__________________________________________________________________________________________________________________________________SRR：替代远程请求位（在扩展格式中在RTR位置，所以得此名），隐性位。此位可判断出标准帧优先于扩展帧
     |      |	 
     |      |_________________________________________________________________________________________________________________________________________StID：标准帧ID，11位
     |
     |________________________________________________________________________________________________________________________________________________帧起始位


*******************************************************************************/
/*设置CAN节点******************************************************************/
//CAN总线节点ID设置，以StdID高3位表示ID
#define		NODE_ID										0x00010000
#define		CMD_SET_SPD_POS_CUR							(NODE_ID|0x00000001)
#define		CMD_SET_CURR								(NODE_ID|0x00000003)
#define		CMD_GET_SPD_POS_CUR							(NODE_ID|0x00000002)
#define		CMD_GET_CURR								(NODE_ID|0x00000004)





/*设置CAN报文命令**************************************************************/






#endif



/******************************END OF CONFIG********************************/
